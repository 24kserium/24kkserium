let localStorageAvailable;function initializeNewCounter(e){const t=buildEndDate(e);let n;n=setInterval(()=>showRemaining(e,t,()=>clearInterval(n)),1e3)}function showRemaining(e,t,n){let o,i,a,r,l=t-new Date;l<0&&(n(),o=0,i=0,a=0,r=0),l>=0&&(o=Math.floor(l/864e5),i=Math.floor(l%864e5/36e5),a=Math.floor(l%36e5/6e4),r=Math.floor(l%6e4/1e3)),e.querySelectorAll(".widget-text[data-format]").forEach(function(e){e.textContent=calculateWidgetValue(e,o,i,a,r)})}function calculateWidgetValue(e,t,n,o,i){return t>99&&"%dd"===e.getAttribute("data-format")&&e.setAttribute("data-format","%ddd"),e.getAttribute("data-format").replace("%ddd",("00"+t).slice(-3)).replace("%dd",("0"+t).slice(-2)).replace("%d",t).replace("%hh",("0"+n).slice(-2)).replace("%mm",("0"+o).slice(-2)).replace("%ss",("0"+i).slice(-2)).replace("%h",n).replace("%m",o).replace("%s",i)}function buildEndDate(e){const t=e.getAttribute("data-strategy");let n=new Date;if("evergreen_counter"===t){const{days:t=0,hours:o=0,minutes:i=0,seconds:a=0}=getParsedAttribute(e,"data-intervals");n.setTime(n.getTime()+24*t*60*60*1e3),n.setTime(n.getTime()+60*o*60*1e3),n.setTime(n.getTime()+60*i*1e3),n.setTime(n.getTime()+1e3*a)}else{const t=e.getAttribute("data-date");n=new Date(t)}if("evergreen_counter"===t){const t=e.getAttribute("id"),o=getEndDateFromLocalStorage(e),i=getEndDateFromCookies(e);window&&window.location&&!window.location.href.includes("editor.landingi")&&(o?n=o:i?n=i:saveEndDate(n,t))}return n}function isLocalStorageAvailable(){let e,t="__storage_test__";if(void 0!==localStorageAvailable)return localStorageAvailable;if(!window||!window.localStorage)return!1;try{return(e=window.localStorage).setItem(t,t),e.removeItem(t),!0}catch(t){return t instanceof DOMException&&([22,1014].includes(t.code)||["QuotaExceededError","NS_ERROR_DOM_QUOTA_REACHED"].includes(t.name))&&e&&0!==e.length}}function getEndDateFromCookies(e){const t=e.getAttribute("id");let n=document.cookie?document.cookie.split(";"):[],o={};for(let e in n)if(n.hasOwnProperty(e)&&"string"==typeof e){let t=n[e].split("=");o[t[0].replace(/\s/g,"")]=t[1]}return o[`count-${t}`]?new Date(o[`count-${t}`]):null}function getEndDateFromLocalStorage(e){if(isLocalStorageAvailable()){const t=e.getAttribute("id");let n=window.localStorage.getItem(`count-${t}`);if(n)try{const e=JSON.parse(n);if(!localStorageIsExpired(e))return new Date(e.value);window.localStorage.removeItem(`count-${t}`)}catch(e){return null}}return null}function localStorageIsExpired(e){if(!e.value||!e.expires)return!0;const t=new Date,n=new Date(e.expires);return t.getTime()>n.getTime()}function saveEndDate(e,t){const n=new Date;if(n.setMonth(n.getMonth()+1),isLocalStorageAvailable()){const o={value:e.getTime(),expires:new Date(n).getTime()};window.localStorage.setItem(`count-${t}`,JSON.stringify(o))}else document.cookie=`count-${t}=${e};expires=${new Date(n)};path=${window.location.pathname}`}function getParsedAttribute(e,t){const n=e.getAttribute(t);return n?JSON.parse(n):{}}const lightboxDefaultCss="\n        .animated-lightbox {\n          transition: visibility 0.5s, opacity 0.5s;\n          visibility: hidden;\n          opacity: 0;\n        }\n    \n        .show-lightbox {\n          opacity: 1;\n          display: block !important;\n          visibility: visible;\n        }\n    ";"undefined"==typeof youtubeVideos&&(window.youtubeVideos=[]),"undefined"==typeof youtubePlayers&&(window.youtubePlayers=[]);const Common={preventDoubleSubmission:function(e){e.onsubmit=function(t){"1"===e.dataset.submitted?(t.preventDefault(),t.stopImmediatePropagation()):e.dataset.submitted="1"}}},LightboxRender={cssManager:{addCssStyle:function(e){const t=document.createElement("style");t.appendChild(document.createTextNode(e));const n=document.getElementsByTagName("head")[0],o=document.getElementsByTagName("link")[0];n.insertBefore(t,o)}},animationManager:{enableAnimationCapabilities:function(e){e.classList.add("animated-lightbox")},show:function(e){e.classList.add("show-lightbox"),e.querySelectorAll(".show-lightbox .widget-counterv2").forEach(e=>initializeNewCounter(e))},hide:function(e){const t=document.querySelectorAll(".tooltip-lightbox");e.classList.remove("show-lightbox"),t.forEach(e=>e.parentNode.removeChild(e))}},youtubeManager:{loadYoutubeApiScript:function(){const e=document.getElementsByTagName("head").item(0).getElementsByTagName("script");if(!(()=>{for(let t of e)if(/(youtube.(?:[a-z{2-3}]+)\/iframe_api)/.test(t.getAttribute("src")))return!0;return!1})()){const t=document.createElement("script");t.src="https://www.youtube.com/iframe_api";const n=e[0];n.parentNode.insertBefore(t,n)}},handlePlayVideo:function(e){void 0!==window.youtubeVideos&&window.youtubeVideos.forEach(function(t){const n=document.getElementById(t.hash).closest(".landingi-popup");n&&n.id===e.id&&1===t.autoplay&&void 0!==window.youtubePlayers[t.hash]&&window.youtubePlayers[t.hash].playVideo()})},handlePauseVideo:function(e){void 0!==window.youtubeVideos&&window.youtubeVideos.forEach(function(t){const n=document.getElementById(t.hash).closest(".landingi-popup");n&&n.id===e.id&&window.youtubePlayers[t.hash]&&"function"==typeof window.youtubePlayers[t.hash].pauseVideo&&window.youtubePlayers[t.hash].pauseVideo()});for(let t of e.querySelectorAll('iframe[data-src*="www.youtube.com/embed/"]'))t.src=t.dataset.src},initializeYoutubeVideos:function(){window.youtubeVideos.forEach(function(e){const t={playerVars:{rel:e.rel,loop:e.loop,showinfo:e.showinfo,controls:e.controls,mute:e.mute},events:{onReady:function(t){e.autoplay&&(!document.getElementsByClassName("video-iframe-container").length&&document.getElementsByClassName("landingi-popup").length||t.target.playVideo())},onStateChange:function(t){0===t.target.getPlayerState()&&0!==e.loop&&t.target.playVideo()}}};e.id&&(t.videoId=e.id),void 0===window.youtubePlayers[e.hash]&&(window.youtubePlayers[e.hash]=new YT.Player(e.hash,t))})}},vimeoManager:{initializeVimeoVideos:function(){const e=document.getElementsByTagName("head").item(0).getElementsByTagName("script"),t="https://player.vimeo.com/api/player.js";let n=!1;for(let o of e)o.getAttribute("src")===t&&(n=!0);if(!1===n){const n=document.createElement("script"),o=e[0];n.src=t,n.addEventListener("load",function(){window.dispatchEvent(new Event("lightbox-vimeo-ready"))}),o.parentNode.insertBefore(n,o)}},injectVimeo:function(e){let t=e.match(/id="([^"]*?)" class="landingi-popup-body"/)[1];const n=document.querySelectorAll("#"+t)[0].closest(".landingi-popup");e.search(/data-vimeo-url/)>0?(LightboxRender.vimeoManager.initializeVimeoVideos(),window.addEventListener("lightbox-vimeo-ready",function(){LightboxRender.lightboxManager.hookCustomScripts(t),LightboxRender.vimeoManager.handlePauseVideos(n)})):LightboxRender.lightboxManager.hookCustomScripts(t)},handlePauseVideos:function(e){for(let t of this.getVimeoPlayers(e))t.pause();for(let t of e.querySelectorAll('iframe[data-src*="player.vimeo.com/video/"]'))t.src=t.dataset.src},handlePlayVideos:function(e){for(let t of this.getVimeoPlayers(e))"1"===t.autoplay&&t.play()},handleMuteVideos:function(e){for(let t of this.getVimeoPlayers(e))t.setVolume(0)},handleUnmuteVideos:function(e){for(let t of this.getVimeoPlayers(e))t.setVolume(1)},getVimeoPlayers:function(e){const t=[];for(let n of e.querySelectorAll("[data-vimeo-url]")){let e=new Vimeo.Player(n.getAttribute("id"),{});e.autoplay=n.getAttribute("data-vimeo-autoplay")||"1",t.push(e)}return t}},datepickerManager:{appendStyle:function(){const e=document.getElementsByTagName("head").item(0),t=e.getElementsByTagName("link");for(let e of t)if("https://old.assets-landingi.com/js/libs/bootstrap-datepicker/dist/css/bootstrap-datepicker.standalone.min.css"===e.getAttribute("href"))return;const n=document.createElement("link"),o=t[0];n.href="https://old.assets-landingi.com/js/libs/bootstrap-datepicker/dist/css/bootstrap-datepicker.standalone.min.css",n.type="text/css",n.rel="stylesheet",e.insertBefore(n,o)},appendScript:function(e){const t="https://old.assets-landingi.com/js/libs/bootstrap-datepicker/dist/js/bootstrap-datepicker.min.js",n="https://old.assets-landingi.com/js/libs/bootstrap-datepicker/dist/locales/bootstrap-datepicker."+e+".min.js",o=document.getElementsByTagName("body").item(0),i=o.getElementsByTagName("script");for(let e of i)if(e.getAttribute("src")===t)return;const a=document.createElement("script"),r=document.createElement("script"),l=i[0!==i.length?i.length-1:i.length];a.type="text/javascript",r.type="text/javascript",a.src=t,r.src=n,o.insertBefore(a,l),o.insertBefore(r,l)},initializeDatepicker:function(e){document.querySelectorAll('.landingi-popup input[subtype="date"]').forEach(function(t){$(t).datepicker({autoclose:!0,clearBtn:!0,format:{en:"dd-mm-yyyy",pl:"dd.mm.yyyy",ru:"dd.mm.yyyy",es:"dd/mm/yyyy",pt:"dd/mm/yyyy",fr:"dd-mm-yyyy",it:"dd-mm-yyyy"}[e],language:e,todayBtn:"linked",todayHighlight:!0})})}},lightboxManager:{loadYoutube:function(){window.youtubeVideos.length<=0&&window.youtubePlayers.length<=0||("undefined"==typeof YT||void 0===YT.Player?LightboxRender.youtubeManager.loadYoutubeApiScript():window.onYouTubeIframeAPIReady())},hookCustomScripts:function(e){let t=document.querySelectorAll("#"+e+" script");for(let e of t){const t=e.parentElement,n=e.getAttribute("src"),o=e.innerHTML;if(null!==n){t.removeChild(e);let o=document.createElement("script");o.src=n,t.appendChild(o)}if(""!==o){t.removeChild(e);let n=document.createElement("script");n.text=o,t.appendChild(n)}}},initializeCounter:function(){document.querySelectorAll(".landingi-popup .widget-counter").forEach(function(e){var t,n,o=e.getAttribute("data-repeat"),i=e.getAttribute("data-version"),a=e.getAttribute("data-date"),r=e.getAttribute("id");if("-1"!==o)n=new Date(a);else{var l=document.cookie?document.cookie.split(";"):[],s={};for(var d in l)if(l.hasOwnProperty(d)&&"string"==typeof d){var c=l[d].split("=");s[c[0].replace(/\s/g,"")]=c[1]}if(s["count-"+r])n=new Date(s["count-"+r]);else{n=new Date;var u=new Date;u.setMonth(u.getMonth()+1),document.cookie="count-"+r+"="+n+";expires="+new Date(u)+";path="+window.location.pathname}n.setMinutes(n.getMinutes()+parseInt(a,10))}i||n.setTime(n.getTime()+60*n.getTimezoneOffset()*1e3),t=setInterval(function(){var a,r,l,s,d=new Date,c=n-d;if(c<0)if(!i||parseInt(i,10)<2||!o||o<=0)clearInterval(t),a=0,r=0,l=0,s=0;else for(;c<0;)n.setDate(n.getDate()+parseInt(o,10)),c=n-d;if(c>=0&&(a=Math.floor(c/864e5),r=Math.floor(c%864e5/36e5),l=Math.floor(c%36e5/6e4),s=Math.floor(c%6e4/1e3)),e.querySelectorAll(".widget-text[data-format]").forEach(function(e){var t=e.getAttribute("data-format");t=(t=(t=(t=(t=(t=(t=(t=(t=(t=t.replace("%dddd",("000"+a).slice(-4))).replace("%ddd",("00"+a).slice(-3))).replace("%dd",("0"+a).slice(-2))).replace("%d",a)).replace("%hh",("0"+r).slice(-2))).replace("%mm",("0"+l).slice(-2))).replace("%ss",("0"+s).slice(-2))).replace("%h",r)).replace("%m",l)).replace("%s",s),e.innerText=t}),0===e.querySelector(".widget-text").length){var u=e.getAttribute("data-format");u=(u=(u=(u=(u=(u=(u=(u=(u=(u=u.replace("%dddd",("000"+a).slice(-4))).replace("%ddd",("00"+a).slice(-3))).replace("%dd",("0"+a).slice(-2))).replace("%d",a)).replace("%hh",("0"+r).slice(-2))).replace("%mm",("0"+l).slice(-2))).replace("%ss",("0"+s).slice(-2))).replace("%h",r)).replace("%m",l)).replace("%s",s),e.innerText(u)}},1e3)})},registerEventHandlers:function(){document.querySelectorAll('[subtype="popup"]').forEach(function(e){const t=e.getAttribute("href").substring(1);let n=document.getElementById(t);n&&LightboxRender.animationManager.enableAnimationCapabilities(n),e.addEventListener("click",function(e){e.preventDefault(),n&&LightboxRender.animationManager.show(n),LightboxRender.youtubeManager.handlePlayVideo(n),LightboxRender.vimeoManager.handlePlayVideos(n)})}),document.querySelectorAll(".widget-popupcloser").forEach(function(e){e.onclick=function(e){e.preventDefault();const t=this.closest(".landingi-popup");LightboxRender.vimeoManager.handlePauseVideos(t),LightboxRender.youtubeManager.handlePauseVideo(t),LightboxRender.animationManager.hide(t)}});const e=document.getElementsByClassName("landingi-popup"),t=()=>{window.positionValidationTooltips()};for(let n of e)n.onclick=function(e){e.target===n.getElementsByClassName("landingi-popup-body")[0]&&(LightboxRender.vimeoManager.handlePauseVideos(n),LightboxRender.youtubeManager.handlePauseVideo(n),LightboxRender.animationManager.hide(n))},n.getElementsByClassName("landingi-popup-body")[0].addEventListener("scroll",t),n.getElementsByClassName("widget-section")&&n.getElementsByClassName("widget-section")[0]&&n.getElementsByClassName("widget-section")[0].addEventListener("scroll",t);document.addEventListener("keydown",function(e){if("Escape"===e.key){const e=document.getElementsByClassName("landingi-popup");for(let t of e)LightboxRender.youtubeManager.handlePauseVideo(t),LightboxRender.animationManager.hide(t)}});const n=document.querySelectorAll(".landingi-popup .widget-form");for(let e of n)Common.preventDoubleSubmission(e)},handleLightboxes:function(){LightboxRender.lightboxManager.registerEventHandlers();const e=document.querySelectorAll(".landingi-popup .widget-form");for(let t of e){const e=function(e){e.preventDefault(),t=document.getElementById(t.id);const o=function(e){if(1===e.indexOf("popuplead//")){const t=e.replace("popuplead//","popuplead/"+landingiInternalDetails.landing_hash+"/");let n=window.location.href+t;return-1!==window.location.href.indexOf("?")&&(n=window.location.href.replace(/(.*)\?(.*)/,`$1${t}?$2`)),n}return e},i=function(e){const n=t.getElementsByClassName("widget-input-button");for(let t of n){const n=t.getElementsByClassName("widget-overlay");e(t,n)}};i(function(e,t){for(let n of t)n.style.color=window.getComputedStyle(e).color,n.innerHTML+='<i class="fa fa-spinner fa-spin"></i>';e.style.color="transparent"});const a=function(e){e.dataset.submitted="0",Array.from(document.getElementsByClassName("form-error-tooltip")).forEach(e=>{e.parentNode.removeChild(e)}),i(function(e,t){for(let e of t)e.removeChild(e.firstChild);e.style.color=""})},r=new FormData(t);r.set("_landing-hash",landingiInternalDetails.landing_hash);const l=new XMLHttpRequest;l.open("POST",function(){let e="https://api.landingi.com/validate";return window.location.href.indexOf(".landingi.it")>0&&(e="https://api.landingi.it/validate"),e}(),!0),l.onreadystatechange=function(){if(this.readyState===XMLHttpRequest.DONE){if(200===this.status)window.submitGAformTracking?(window.submitGAformTracking(),setTimeout(function(){t.setAttribute("action",o(t.getAttribute("action"))),t.dataset.submitted="0",document.removeEventListener("submit",n),t.submit()},300)):(t.setAttribute("action",o(t.getAttribute("action"))),t.dataset.submitted="0",document.removeEventListener("submit",n),t.submit());else if(400===this.status){a(t);let e=JSON.parse(l.response).html;validateCallbacks.forEach(function(t){let n=t(e);n&&(e=n)}),document.getElementsByTagName("body").item(0).insertAdjacentHTML("beforeend",e),window.positionValidationTooltips(),window.scrollToFirstTooltip()}else console.error("LightboxRender: Unexpected response occurred");LightboxRender.lightboxManager.registerEventHandlers()}},l.onerror=function(){a(t),LightboxRender.lightboxManager.registerEventHandlers(),console.error("LightboxRender: An error occured while sending form validation XHR")},l.send(r)},n=function(n){const o=t.id;n.target.id===o&&e(n)};document.addEventListener("submit",n)}},injectLightboxes:function(e){const t=new XMLHttpRequest;t.onload=function(){const e=JSON.parse(t.response),n=document.getElementsByTagName("body")[0],o=document.getElementsByTagName("head")[0];if(!n)return;const i=[],a=[];for(let e of document.getElementsByTagName("link"))i.push(e.href);e.forEach(function(e){n.insertAdjacentHTML("beforeend",e.content),n.insertAdjacentHTML("beforeend",'<link href="'+e.style_url+'" rel="stylesheet" type="text/css">'),e.fonts.forEach(function(e){i.includes(e)||a.includes(e)||(a.push(e),o.insertAdjacentHTML("beforeend",'<link href="'+e+'" rel="stylesheet" type="text/css">'))}),LightboxRender.vimeoManager.injectVimeo(e.content)});const r=new Event("lightboxes-ready");o.dispatchEvent(r),e.length&&(LightboxRender.lightboxManager.initializeCounter(),LightboxRender.lightboxManager.handleLightboxes(),LightboxRender.datepickerManager.initializeDatepicker(landingiInternalDetails.landing_lang),LightboxRender.lightboxManager.loadYoutube())},t.open("GET",this.getRenderUrl(landingiInternalDetails.apikey,landingiInternalDetails.landing_id,e)),t.send()},getRenderUrl:function(e,t,n){let o="https://lightboxes.landingi.com/api/v1/render?apikey="+e+"&landing_id="+t;return window.location.href.indexOf(".landingi.it")>0&&(o="https://lightboxes.landingi.it/api/v1/render?apikey="+e+"&landing_id="+t),n&&(o+="&aaf="+window.location.pathname),o}},init:function(e={useAaf:!1}){LightboxRender.cssManager.addCssStyle(lightboxDefaultCss),window.onYouTubeIframeAPIReady=function(){LightboxRender.youtubeManager.initializeYoutubeVideos()},LightboxRender.datepickerManager.appendStyle(),LightboxRender.datepickerManager.appendScript(landingiInternalDetails.landing_lang),LightboxRender.lightboxManager.injectLightboxes(e.useAaf)}};
